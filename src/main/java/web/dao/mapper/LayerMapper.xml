<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="web.dao.face.LayerDao">
	<select id="selectLayerListByTarget" resultType="HashMap" parameterType="HashMap">
   SELECT * FROM ( 
        SELECT rownum rnum, A.*FROM(
            SELECT
                l.LAYERING_NO, l.USER_NO, l.PERFUME_NO1
                , l.PERFUME_NO2, l.PERFUME1_PER, l.LAYERING_CONTENT, l.LAYERING_DATE
                , u.nick, (SELECT count(*) FROM tb_layer_like where layering_no = l.layering_no) SCnt
            FROM tb_layer l 
            LEFT OUTER JOIN tb_user u ON  l.user_no = u.user_no  
            <choose>
            <when test="target == 1 || target == null">
            	ORDER BY LAYERING_NO DESC
            </when>
            <when test="target == 2">
            	ORDER BY SCnt DESC
            </when>
            </choose>
        )A
    )layer_list
     WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	<select id="selectLayerCntAll" resultType="int">
		SELECT count(*) FROM tb_layer
	</select>
</mapper>